<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EduConnect Teacher - Attendance</title>
  <!-- Icons & Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <!-- Global & Page CSS -->
  <link rel="stylesheet" href="../dashboard/dashboard.css"/>
  <link rel="stylesheet" href="attendance.css"/>
</head>
<body>
  <div class="dashboard">
    <!-- Sidebar -->
    <div id="sidebar-container"></div>

    <!-- Main Content -->
    <div class="main">
      <!-- Header -->
      <header class="header-top d-flex align-items-center justify-content-between px-4">
       <img src="/assets/educonnect_logo.png" alt="EduConnect Logo" class="logo-header" />
        <div class="search-box position-relative">
          <input type="text" class="form-control" placeholder="Search..."/>
          <i class="fas fa-search position-absolute"
             style="top:50%; right:15px; transform:translateY(-50%);"></i>
        </div>
        <button class="profile-btn btn btn-link text-decoration-none" onclick="logoutUser()">
          <i class="fas fa-user-circle fa-2x"></i>
          <span id="Username" class="username ms-2 fw-semibold">Teacher Name</span>
        </button>
      </header>

      <!-- Page Content -->
      <section class="content">
        <!-- Title & Controls -->
        <div class="row align-items-center mb-4">
          <div class="col-md-5">
            <h1 class="page-title mb-0">Attendance: STEM-11A</h1>
          </div>
          <div class="col-md-7">
            <div class="row g-2">
              <div class="col-sm-5">
                <label for="attendanceDate" class="form-label">Date</label>
                <input type="date" id="attendanceDate" class="form-control" required>
              </div>
              <div class="col-sm-5">
                <label for="attendancePeriod" class="form-label">Period</label>
                <select id="attendancePeriod" class="form-select" required>
                  <option value="">Select period</option>
                  <option value="1">Period 1 (08:00–09:00)</option>
                  <option value="2">Period 2 (09:00–10:00)</option>
                  <option value="3">Period 3 (10:00–11:00)</option>
                  <option value="4">Period 4 (11:00–12:00)</option>
                  <option value="5">Period 5 (13:00–14:00)</option>
                  <option value="6">Period 6 (14:00–15:00)</option>
                </select>
              </div>
              <div class="col-sm-2 d-flex align-items-end">
                <button class="btn btn-link help-btn" onclick="window.open('/help/attendance.html','_blank')">
                  <i class="bi bi-question-circle"></i> Help
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Attendance Form -->
        <form id="attendanceForm">
          <div class="table-responsive mb-3">
            <table class="table table-bordered align-middle" id="attendanceTable">
              <thead class="table-light">
                <tr>
                  <th>Student Name</th>
                  <th>Student ID</th>
                  <th class="text-center">Present</th>
                  <th class="text-center">Absent</th>
                  <th class="text-center">Late</th>
                </tr>
              </thead>
              <tbody>
                <!-- Static rows; replace with dynamic data later -->
                <tr>
                  <td>Ana Santos</td>
                  <td>2025-1101</td>
                  <td class="text-center"><input type="radio" name="status_2025-1101" value="present" checked></td>
                  <td class="text-center"><input type="radio" name="status_2025-1101" value="absent"></td>
                  <td class="text-center"><input type="radio" name="status_2025-1101" value="late"></td>
                </tr>
                <tr>
                  <td>Juan Dela Cruz</td>
                  <td>2025-1102</td>
                  <td class="text-center"><input type="radio" name="status_2025-1102" value="present"></td>
                  <td class="text-center"><input type="radio" name="status_2025-1102" value="absent" checked></td>
                  <td class="text-center"><input type="radio" name="status_2025-1102" value="late"></td>
                </tr>
                <tr>
                  <td>María Reyes</td>
                  <td>2025-1103</td>
                  <td class="text-center"><input type="radio" name="status_2025-1103" value="present"></td>
                  <td class="text-center"><input type="radio" name="status_2025-1103" value="absent"></td>
                  <td class="text-center"><input type="radio" name="status_2025-1103" value="late" checked></td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Actions: Save + View All -->
          <div class="d-flex justify-content-between align-items-center">
            <button type="button" class="btn btn-outline-secondary" onclick="viewAllAttendance()">
              <i class="bi bi-list-ul"></i> View All Attendance
            </button>
            <div>
              <button type="reset" class="btn btn-outline-secondary me-2">Reset</button>
              <button type="submit" class="btn btn-primary">Save Attendance</button>
            </div>
          </div>
        </form>
      </section>
    </div>
  </div>

  <!-- Sidebar Logic -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      fetch("/components/sidebar.html").then(r=>r.text()).then(html=>{
        document.getElementById("sidebar-container").innerHTML = html;
        const sb = document.querySelector(".sidebar"), db = document.querySelector(".dashboard");
        sb&&db&&(sb.addEventListener("mouseenter",()=>db.classList.add("sidebar-expanded")),
                 sb.addEventListener("mouseleave",()=>db.classList.remove("sidebar-expanded")));
        document.querySelectorAll('.has-submenu .submenu-toggle').forEach(t=>{
          t.addEventListener('click',e=>{
            e.preventDefault();
            const p=t.closest('.has-submenu');
            p.classList.toggle('open');
            t.setAttribute('aria-expanded',p.classList.contains('open'));
          });
        });
      });
    });
  </script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Defaults & Handlers -->
  <script>
    // Default date to today
    document.addEventListener('DOMContentLoaded',()=> {
      const d=document.getElementById('attendanceDate');
      d.value=new Date().toISOString().split('T')[0];
    });

    // Save attendance
    document.getElementById('attendanceForm').addEventListener('submit',function(e){
      e.preventDefault();
      const date=document.getElementById('attendanceDate').value;
      const period=document.getElementById('attendancePeriod').value;
      if(!period){alert('Select a period.');return;}
      const recs=[...document.querySelectorAll('#attendanceTable tbody tr')].map(r=>{
        const id=r.children[1].textContent.trim();
        const status=r.querySelector(`input[name="status_${id}"]:checked`).value;
        return { studentId:id,status };
      });
      alert(`Saved for ${date}, Period ${period} (${recs.length} students).`);
      console.log({ date, period, recs });
      // TODO: POST to backend
    });

    function viewAllAttendance(){
      // stub: navigate to history page
      window.location.href = '/TEACHER/attendance/history.html';
    }

    function logoutUser(){
      alert('Logging out…');
    }

    // Auth stub
    const userData={role:'teacher',username:'Teacher Name'};
    if(userData.role!=='teacher') location.href='/TEACHER/login/login.html';
    else document.getElementById('Username').textContent=userData.username;
  </script>
</body>
</html>
